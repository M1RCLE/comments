# PostHub

Сервис реализует систему для добавления и чтения постов и комментариев с использованием GraphQL, аналогичную комментариям к постам на популярных платформах, таких как Хабр или Reddit.

# Возможности сервиса

### Система постов:
- Предоставляет возможность просмотра списка постов
- Предоставляет возможность просмотра поста и комментариев под ним
- Пользователь, написавший пост, может **запретить** оставление комментариев к своему посту

### Система комментариев к постам:
- Комментарии организованы иерархически, позволяя вложенность **без ограничений**
- Длина текста комментария **ограничена до 2000 символов**
- Предоставляет систему пагинации для получения списка комментариев к посту или же всех комментариев в целом

### Дополнительные возможности:
- Предоставляет возможность асинхронной доставки комментариев к постам через **GraphQL Subscriptions**. Клиенты, подписанные на определенный пост, получают уведомления о новых комментариях **без необходимости повторного запроса**

### Реализация:
- Сервис написан на языке **Go**
- Используется **Docker** для распространения сервиса в виде Docker-образа
- Хранение данных может быть как в **памяти (in-memory)**, так и в **PostgreSQL**. Выбор хранилища определяется параметром при запуске сервиса
- Реализованный функционал покрыт **unit-тестами**

#### Запуск и конфигурация

Перед запуском приложения, нужно прописать переменные в .env файл. Если же вы будете пользоваться хранением данных в **PostgreSQL**, необходимо дополнительно ввести параметры базы данных в **bd/flyway/conf/flyway.conf**

Запуск:
1. Билд образа
    ```shell
    go build .
    ```
2. Запуск контейнеров
    ```shell
    docker-compose up
    ```
### Использование

Сервис предоставляет 2 enpoint

- /graphql : GraphQL ручка
- /        : GraphQL Playground

Схемы GraphQL находится в папке **graph/schemas**


### Create post
```
mutation CreatePost($post: PostInput!) {
   createPost(post: $post) {
      id
      body
      userId
      comments {
         id
         userId
         postId
         body
         parentId
         creationTime
      }
      commentsAllowed
   }
}

variables 
{
  "post": {
    "userId": "123",
    "body": "This is my first post!",
    "commentsAllowed": true
  }
}
```

### Get post
```
query Post($postId: ID!) {
  post(postId: $postId) {
    id
    body
    userId
    comments {
      id
      userId
      postId
      body
      parentId
      creationTime
    }
    commentsAllowed
  }
}

variables
{
  "postId": 1
}
```


